import{a}from"./axios-B6xwUs71.js";import{j as c}from"./index-VWaDGczM.js";import{T as k}from"./index-DA7c_E-X.js";import{l as n}from"./logout-N69Hl7hh.js";import{g as d}from"./Set_Get-jfIHgayU.js";const w=a.create(),g=async()=>{try{let r=d("refresh_token");const{data:e}=await a.post(k+"/refresh_token",{refresh_token:r});return e==null?void 0:e.access_token}catch{n("Session expired ,please Login")}},f=async()=>{var r;try{let e=d("access_token");if(!e){console.warn("Access token is missing, requesting new access token");const l=await g();if(!l)throw new Error("Failed to obtain new access token");e=l}const{data:o}=await a.get(k+`/accessToken?access_token=${e}`);let s=e,t=(o==null?void 0:o.user)||(o==null?void 0:o.doctor);const m=await c(s),{role:i}=m;return(i==="doctor"||i==="user")&&(t.isBlocked?n("Your account has been blocked by administrator","error"):(r=t==null?void 0:t.doctor)!=null&&r.isBlocked&&n("Your account has been blocked by administrator","error")),s}catch(e){console.log(e,"Error in getting token")}};w.interceptors.request.use(async r=>{let e=new Date,o,s;try{s=await f(),o=await c(s),console.log(o,"decodedToken")}catch(t){console.log("error in decodeToken"+t)}if(o.exp*1e3<e.getTime()){for(let t=0;t<100;t++)console.log(o.exp+"  : decoaded token ");s=await g(),o=c(s)}return r.headers.Authorization="Bearer "+s,r});export{w as a};
